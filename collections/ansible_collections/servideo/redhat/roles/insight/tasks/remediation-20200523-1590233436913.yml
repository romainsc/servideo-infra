---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to review and if you
# deem appropriate, deploy on your systems running Red Hat software. Based on the analysis, we have automatically
# generated an Ansible Playbook for you. Please review and test the recommended actions and the Playbook as
# they may contain configuration changes, updates, reboots and/or other changes to your systems. Red Hat is not
# responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# Remediation 20200523
# https://cloud.redhat.com/insights/remediations/d19551fa-9fca-4123-9d69-af23d07859b3
# Generated by Red Hat Insights on Sat, 23 May 2020 11:30:36 GMT
# Created by rhn-support-rchanter

# Upgrade the following packages:
#   - Upgrade packages affected by CVE-2018-12126
#   - Upgrade packages affected by CVE-2018-12127
#   - Upgrade packages affected by CVE-2018-12130
#   - Upgrade packages affected by CVE-2018-13139
#   - Upgrade packages affected by CVE-2018-14404
#   - Upgrade packages affected by CVE-2018-16871
#   - Upgrade packages affected by CVE-2018-18074
#   - Upgrade packages affected by CVE-2018-19662
#   - Upgrade packages affected by CVE-2018-20060
#   - Upgrade packages affected by CVE-2018-20337
#   - Upgrade packages affected by CVE-2018-20852
#   - Upgrade packages affected by CVE-2018-3620
#   - Upgrade packages affected by CVE-2018-3646
#   - Upgrade packages affected by CVE-2018-7263
#   - Upgrade packages affected by CVE-2018-9251
#   - Upgrade packages affected by CVE-2019-1010204
#   - Upgrade packages affected by CVE-2019-10639
#   - Upgrade packages affected by CVE-2019-11091
#   - Upgrade packages affected by CVE-2019-11236
#   - Upgrade packages affected by CVE-2019-11324
#   - Upgrade packages affected by CVE-2019-12447
#   - Upgrade packages affected by CVE-2019-12448
#   - Upgrade packages affected by CVE-2019-12449
#   - Upgrade packages affected by CVE-2019-13752
#   - Upgrade packages affected by CVE-2019-13753
#   - Upgrade packages affected by CVE-2019-14563
#   - Upgrade packages affected by CVE-2019-14822
#   - Upgrade packages affected by CVE-2019-14834
#   - Upgrade packages affected by CVE-2019-14973
#   - Upgrade packages affected by CVE-2019-15030
#   - Upgrade packages affected by CVE-2019-15031
#   - Upgrade packages affected by CVE-2019-15090
#   - Upgrade packages affected by CVE-2019-15099
#   - Upgrade packages affected by CVE-2019-15221
#   - Upgrade packages affected by CVE-2019-1547
#   - Upgrade packages affected by CVE-2019-1549
#   - Upgrade packages affected by CVE-2019-1563
#   - Upgrade packages affected by CVE-2019-15847
#   - Upgrade packages affected by CVE-2019-16056
#   - Upgrade packages affected by CVE-2019-16234
#   - Upgrade packages affected by CVE-2019-17041
#   - Upgrade packages affected by CVE-2019-17042
#   - Upgrade packages affected by CVE-2019-17053
#   - Upgrade packages affected by CVE-2019-17055
#   - Upgrade packages affected by CVE-2019-17451
#   - Upgrade packages affected by CVE-2019-18660
#   - Upgrade packages affected by CVE-2019-18805
#   - Upgrade packages affected by CVE-2019-18934
#   - Upgrade packages affected by CVE-2019-19045
#   - Upgrade packages affected by CVE-2019-19047
#   - Upgrade packages affected by CVE-2019-19055
#   - Upgrade packages affected by CVE-2019-19057
#   - Upgrade packages affected by CVE-2019-19058
#   - Upgrade packages affected by CVE-2019-19059
#   - Upgrade packages affected by CVE-2019-19065
#   - Upgrade packages affected by CVE-2019-19067
#   - Upgrade packages affected by CVE-2019-19073
#   - Upgrade packages affected by CVE-2019-19074
#   - Upgrade packages affected by CVE-2019-19077
#   - Upgrade packages affected by CVE-2019-19126
#   - Upgrade packages affected by CVE-2019-19232
#   - Upgrade packages affected by CVE-2019-19527
#   - Upgrade packages affected by CVE-2019-19534
#   - Upgrade packages affected by CVE-2019-19768
#   - Upgrade packages affected by CVE-2019-19921
#   - Upgrade packages affected by CVE-2019-19922
#   - Upgrade packages affected by CVE-2019-19923
#   - Upgrade packages affected by CVE-2019-19924
#   - Upgrade packages affected by CVE-2019-19925
#   - Upgrade packages affected by CVE-2019-19959
#   - Upgrade packages affected by CVE-2019-3825
#   - Upgrade packages affected by CVE-2019-3843
#   - Upgrade packages affected by CVE-2019-3844
#   - Upgrade packages affected by CVE-2019-5094
#   - Upgrade packages affected by CVE-2019-5436
#   - Upgrade packages affected by CVE-2019-5481
#   - Upgrade packages affected by CVE-2019-5482
#   - Upgrade packages affected by CVE-2019-6477
#   - Upgrade packages affected by CVE-2019-8457
#   - Upgrade packages affected by CVE-2019-8675
#   - Upgrade packages affected by CVE-2019-8696
#   - Upgrade packages affected by CVE-2019-8980
#   - Upgrade packages affected by CVE-2020-10531
#   - Upgrade packages affected by CVE-2020-10684
#   - Upgrade packages affected by CVE-2020-10685
#   - Upgrade packages affected by CVE-2020-10696
#   - Upgrade packages affected by CVE-2020-10711
#   - Upgrade packages affected by CVE-2020-11501
#   - Upgrade packages affected by CVE-2020-11884
#   - Upgrade packages affected by CVE-2020-1702
#   - Upgrade packages affected by CVE-2020-1711
#   - Upgrade packages affected by CVE-2020-1726
#   - Upgrade packages affected by CVE-2020-1733
#   - Upgrade packages affected by CVE-2020-1735
#   - Upgrade packages affected by CVE-2020-1737
#   - Upgrade packages affected by CVE-2020-1739
#   - Upgrade packages affected by CVE-2020-1740
#   - Upgrade packages affected by CVE-2020-1746
#   - Upgrade packages affected by CVE-2020-1749
#   - Upgrade packages affected by CVE-2020-1763
#   - Upgrade packages affected by CVE-2020-2732
#   - Upgrade packages affected by CVE-2020-7039
#   - Upgrade packages affected by CVE-2020-8608
# Identifier: (vulnerabilities:CVE-2018-12126,vulnerabilities:CVE-2018-12127,vulnerabilities:CVE-2018-12130,vulnerabilities:CVE-2018-13139,vulnerabilities:CVE-2018-14404,vulnerabilities:CVE-2018-16871,vulnerabilities:CVE-2018-18074,vulnerabilities:CVE-2018-19662,vulnerabilities:CVE-2018-20060,vulnerabilities:CVE-2018-20337,vulnerabilities:CVE-2018-20852,vulnerabilities:CVE-2018-3620,vulnerabilities:CVE-2018-3646,vulnerabilities:CVE-2018-7263,vulnerabilities:CVE-2018-9251,vulnerabilities:CVE-2019-1010204,vulnerabilities:CVE-2019-10639,vulnerabilities:CVE-2019-11091,vulnerabilities:CVE-2019-11236,vulnerabilities:CVE-2019-11324,vulnerabilities:CVE-2019-12447,vulnerabilities:CVE-2019-12448,vulnerabilities:CVE-2019-12449,vulnerabilities:CVE-2019-13752,vulnerabilities:CVE-2019-13753,vulnerabilities:CVE-2019-14563,vulnerabilities:CVE-2019-14822,vulnerabilities:CVE-2019-14834,vulnerabilities:CVE-2019-14973,vulnerabilities:CVE-2019-15030,vulnerabilities:CVE-2019-15031,vulnerabilities:CVE-2019-15090,vulnerabilities:CVE-2019-15099,vulnerabilities:CVE-2019-15221,vulnerabilities:CVE-2019-1547,vulnerabilities:CVE-2019-1549,vulnerabilities:CVE-2019-1563,vulnerabilities:CVE-2019-15847,vulnerabilities:CVE-2019-16056,vulnerabilities:CVE-2019-16234,vulnerabilities:CVE-2019-17041,vulnerabilities:CVE-2019-17042,vulnerabilities:CVE-2019-17053,vulnerabilities:CVE-2019-17055,vulnerabilities:CVE-2019-17451,vulnerabilities:CVE-2019-18660,vulnerabilities:CVE-2019-18805,vulnerabilities:CVE-2019-18934,vulnerabilities:CVE-2019-19045,vulnerabilities:CVE-2019-19047,vulnerabilities:CVE-2019-19055,vulnerabilities:CVE-2019-19057,vulnerabilities:CVE-2019-19058,vulnerabilities:CVE-2019-19059,vulnerabilities:CVE-2019-19065,vulnerabilities:CVE-2019-19067,vulnerabilities:CVE-2019-19073,vulnerabilities:CVE-2019-19074,vulnerabilities:CVE-2019-19077,vulnerabilities:CVE-2019-19126,vulnerabilities:CVE-2019-19232,vulnerabilities:CVE-2019-19527,vulnerabilities:CVE-2019-19534,vulnerabilities:CVE-2019-19768,vulnerabilities:CVE-2019-19921,vulnerabilities:CVE-2019-19922,vulnerabilities:CVE-2019-19923,vulnerabilities:CVE-2019-19924,vulnerabilities:CVE-2019-19925,vulnerabilities:CVE-2019-19959,vulnerabilities:CVE-2019-3825,vulnerabilities:CVE-2019-3843,vulnerabilities:CVE-2019-3844,vulnerabilities:CVE-2019-5094,vulnerabilities:CVE-2019-5436,vulnerabilities:CVE-2019-5481,vulnerabilities:CVE-2019-5482,vulnerabilities:CVE-2019-6477,vulnerabilities:CVE-2019-8457,vulnerabilities:CVE-2019-8675,vulnerabilities:CVE-2019-8696,vulnerabilities:CVE-2019-8980,vulnerabilities:CVE-2020-10531,vulnerabilities:CVE-2020-10684,vulnerabilities:CVE-2020-10685,vulnerabilities:CVE-2020-10696,vulnerabilities:CVE-2020-10711,vulnerabilities:CVE-2020-11501,vulnerabilities:CVE-2020-11884,vulnerabilities:CVE-2020-1702,vulnerabilities:CVE-2020-1711,vulnerabilities:CVE-2020-1726,vulnerabilities:CVE-2020-1733,vulnerabilities:CVE-2020-1735,vulnerabilities:CVE-2020-1737,vulnerabilities:CVE-2020-1739,vulnerabilities:CVE-2020-1740,vulnerabilities:CVE-2020-1746,vulnerabilities:CVE-2020-1749,vulnerabilities:CVE-2020-1763,vulnerabilities:CVE-2020-2732,vulnerabilities:CVE-2020-7039,vulnerabilities:CVE-2020-8608,fix)
# Version: ca9f5b056fa705384bb58d4a88410d039c462a4d
- name: update vulnerable packages
  hosts: "hetzner001.servideo.org"
  become: true
  tasks:
    - name: check for update
      shell: "{{ ansible_facts['pkg_mgr'] }} check-update -q --cve CVE-2018-12126 --cve CVE-2018-12127 --cve CVE-2018-12130 --cve CVE-2018-13139 --cve CVE-2018-14404 --cve CVE-2018-16871 --cve CVE-2018-18074 --cve CVE-2018-19662 --cve CVE-2018-20060 --cve CVE-2018-20337 --cve CVE-2018-20852 --cve CVE-2018-3620 --cve CVE-2018-3646 --cve CVE-2018-7263 --cve CVE-2018-9251 --cve CVE-2019-1010204 --cve CVE-2019-10639 --cve CVE-2019-11091 --cve CVE-2019-11236 --cve CVE-2019-11324 --cve CVE-2019-12447 --cve CVE-2019-12448 --cve CVE-2019-12449 --cve CVE-2019-13752 --cve CVE-2019-13753 --cve CVE-2019-14563 --cve CVE-2019-14822 --cve CVE-2019-14834 --cve CVE-2019-14973 --cve CVE-2019-15030 --cve CVE-2019-15031 --cve CVE-2019-15090 --cve CVE-2019-15099 --cve CVE-2019-15221 --cve CVE-2019-1547 --cve CVE-2019-1549 --cve CVE-2019-1563 --cve CVE-2019-15847 --cve CVE-2019-16056 --cve CVE-2019-16234 --cve CVE-2019-17041 --cve CVE-2019-17042 --cve CVE-2019-17053 --cve CVE-2019-17055 --cve CVE-2019-17451 --cve CVE-2019-18660 --cve CVE-2019-18805 --cve CVE-2019-18934 --cve CVE-2019-19045 --cve CVE-2019-19047 --cve CVE-2019-19055 --cve CVE-2019-19057 --cve CVE-2019-19058 --cve CVE-2019-19059 --cve CVE-2019-19065 --cve CVE-2019-19067 --cve CVE-2019-19073 --cve CVE-2019-19074 --cve CVE-2019-19077 --cve CVE-2019-19126 --cve CVE-2019-19232 --cve CVE-2019-19527 --cve CVE-2019-19534 --cve CVE-2019-19768 --cve CVE-2019-19921 --cve CVE-2019-19922 --cve CVE-2019-19923 --cve CVE-2019-19924 --cve CVE-2019-19925 --cve CVE-2019-19959 --cve CVE-2019-3825 --cve CVE-2019-3843 --cve CVE-2019-3844 --cve CVE-2019-5094 --cve CVE-2019-5436 --cve CVE-2019-5481 --cve CVE-2019-5482 --cve CVE-2019-6477 --cve CVE-2019-8457 --cve CVE-2019-8675 --cve CVE-2019-8696 --cve CVE-2019-8980 --cve CVE-2020-10531 --cve CVE-2020-10684 --cve CVE-2020-10685 --cve CVE-2020-10696 --cve CVE-2020-10711 --cve CVE-2020-11501 --cve CVE-2020-11884 --cve CVE-2020-1702 --cve CVE-2020-1711 --cve CVE-2020-1726 --cve CVE-2020-1733 --cve CVE-2020-1735 --cve CVE-2020-1737 --cve CVE-2020-1739 --cve CVE-2020-1740 --cve CVE-2020-1746 --cve CVE-2020-1749 --cve CVE-2020-1763 --cve CVE-2020-2732 --cve CVE-2020-7039 --cve CVE-2020-8608"
      check_mode: no
      register: check_out
      failed_when: check_out.rc != 0 and check_out.rc != 100
      args:
        warn: false

    - when: check_out.rc == 100
      name: upgrade package
      shell: "{{ ansible_facts['pkg_mgr'] }} update -d 2 -y --cve CVE-2018-12126 --cve CVE-2018-12127 --cve CVE-2018-12130 --cve CVE-2018-13139 --cve CVE-2018-14404 --cve CVE-2018-16871 --cve CVE-2018-18074 --cve CVE-2018-19662 --cve CVE-2018-20060 --cve CVE-2018-20337 --cve CVE-2018-20852 --cve CVE-2018-3620 --cve CVE-2018-3646 --cve CVE-2018-7263 --cve CVE-2018-9251 --cve CVE-2019-1010204 --cve CVE-2019-10639 --cve CVE-2019-11091 --cve CVE-2019-11236 --cve CVE-2019-11324 --cve CVE-2019-12447 --cve CVE-2019-12448 --cve CVE-2019-12449 --cve CVE-2019-13752 --cve CVE-2019-13753 --cve CVE-2019-14563 --cve CVE-2019-14822 --cve CVE-2019-14834 --cve CVE-2019-14973 --cve CVE-2019-15030 --cve CVE-2019-15031 --cve CVE-2019-15090 --cve CVE-2019-15099 --cve CVE-2019-15221 --cve CVE-2019-1547 --cve CVE-2019-1549 --cve CVE-2019-1563 --cve CVE-2019-15847 --cve CVE-2019-16056 --cve CVE-2019-16234 --cve CVE-2019-17041 --cve CVE-2019-17042 --cve CVE-2019-17053 --cve CVE-2019-17055 --cve CVE-2019-17451 --cve CVE-2019-18660 --cve CVE-2019-18805 --cve CVE-2019-18934 --cve CVE-2019-19045 --cve CVE-2019-19047 --cve CVE-2019-19055 --cve CVE-2019-19057 --cve CVE-2019-19058 --cve CVE-2019-19059 --cve CVE-2019-19065 --cve CVE-2019-19067 --cve CVE-2019-19073 --cve CVE-2019-19074 --cve CVE-2019-19077 --cve CVE-2019-19126 --cve CVE-2019-19232 --cve CVE-2019-19527 --cve CVE-2019-19534 --cve CVE-2019-19768 --cve CVE-2019-19921 --cve CVE-2019-19922 --cve CVE-2019-19923 --cve CVE-2019-19924 --cve CVE-2019-19925 --cve CVE-2019-19959 --cve CVE-2019-3825 --cve CVE-2019-3843 --cve CVE-2019-3844 --cve CVE-2019-5094 --cve CVE-2019-5436 --cve CVE-2019-5481 --cve CVE-2019-5482 --cve CVE-2019-6477 --cve CVE-2019-8457 --cve CVE-2019-8675 --cve CVE-2019-8696 --cve CVE-2019-8980 --cve CVE-2020-10531 --cve CVE-2020-10684 --cve CVE-2020-10685 --cve CVE-2020-10696 --cve CVE-2020-10711 --cve CVE-2020-11501 --cve CVE-2020-11884 --cve CVE-2020-1702 --cve CVE-2020-1711 --cve CVE-2020-1726 --cve CVE-2020-1733 --cve CVE-2020-1735 --cve CVE-2020-1737 --cve CVE-2020-1739 --cve CVE-2020-1740 --cve CVE-2020-1746 --cve CVE-2020-1749 --cve CVE-2020-1763 --cve CVE-2020-2732 --cve CVE-2020-7039 --cve CVE-2020-8608"
      args:
        warn: false

    - when: check_out.rc == 100
      name: set reboot fact
      set_fact:
        insights_needs_reboot: True

# Reboots a system if any of the preceeding plays sets the 'insights_needs_reboot' variable to true.
# The variable can be overridden to suppress this behavior.
- name: Reboot system (if applicable)
  hosts: "hetzner001.servideo.org"
  become: True
  gather_facts: False
  tasks:
    - when:
        - insights_needs_reboot is defined
        - insights_needs_reboot
      block:
        - name: Reboot system
          shell: sleep 2 && shutdown -r now "Ansible triggered reboot"
          async: 1
          poll: 0
          ignore_errors: true

        - name: Wait for system to boot up
          local_action:
            module: wait_for
            host: "{{ hostvars[inventory_hostname]['ansible_host'] | default(hostvars[inventory_hostname]['ansible_ssh_host'], true) | default(inventory_hostname, true) }}"
            port: "{{ hostvars[inventory_hostname]['ansible_port'] | default(hostvars[inventory_hostname]['ansible_ssh_port'], true) | default('22', true) }}"
            delay: 15
            search_regex: OpenSSH
            timeout: 300
          become: false

- name: run insights
  hosts: "hetzner001.servideo.org"
  become: True
  gather_facts: False
  tasks:
    - name: run insights
      command: insights-client
      changed_when: false